# V Panel 功能补充说明

## 🔧 最近修复记录

### 2026-01-14: 订阅管理 500 错误修复

**问题描述**：
- `api/subscription/link` 返回 500 Internal Server Error
- `api/system/status` 返回 401 Unauthorized

**根本原因**：
- 数据库迁移中缺少 `subscriptions` 表的创建

**修复内容**：
1. `internal/database/db.go` - 在 `AutoMigrate()` 函数中添加了 `&repository.Subscription{}`
2. `internal/api/handlers/subscription.go` - 改进了错误日志，添加更详细的错误类型信息

**使用说明**：
- 重启服务后，数据库会自动创建 `subscriptions` 表
- 401 错误是认证问题，确保已登录且 token 未过期

---

## 📋 功能规划总览

### ✅ 已完成的功能
- 多协议支持 (VMess, VLESS, Trojan, Shadowsocks)
- 用户管理（认证授权、流量限制、状态监控、多级权限）
- 流量管理（实时统计、每日统计、流量限制和警告）
- 证书管理（自动 SSL 证书申请和更新、多域名支持）
- Xray 管理（版本切换、远程更新、运行状态监控）
- 系统管理（完整日志系统、系统状态监控、配置管理）
- 角色权限管理
- 代理启停控制和批量操作

### 📝 已创建 Spec 待实现
1. **订阅链接功能** - `.kiro/specs/subscription-system/`
   - 生成用户专属订阅链接
   - 支持多种客户端格式 (Clash/V2rayN/Shadowrocket/Surge/Sing-box)
   - 订阅链接自动更新
   - 短链接支持

2. **用户前台门户** - `.kiro/specs/user-portal/`
   - 用户注册/登录系统（邮箱验证、邀请码、2FA）
   - 用户仪表板（流量统计、到期提醒）
   - 节点列表页面（过滤、排序、延迟测试）
   - 订阅管理页面
   - 客户端下载页面
   - 个人设置页面
   - 公告通知中心
   - 工单支持系统
   - 使用统计页面
   - 知识库帮助中心
   - 移动端适配

### 🔜 待创建 Spec 的功能
2. **Telegram Bot 集成** - 系统状态通知、流量警告、用户到期提醒、Bot 管理
3. **IP 限制功能** - 限制同时在线 IP 数量、防止账号共享
4. **数据库备份/恢复** - 自动定时备份、一键恢复、云存储备份
5. **多服务器管理** - 管理多个 Xray 节点、负载均衡、节点健康检查
6. **更多协议支持** - WireGuard、Reality (XTLS)、HTTP/SOCKS 代理
7. **高级流量功能** - 流量重置周期、流量包购买/续费、流量预警通知

---

## 🚨 缺失功能：用户前台页面

V Panel 目前只有**管理后台**，缺少**用户前台页面**（客户端门户）。

### 需要补充的用户前台功能模块

#### 1. **用户注册/登录系统** ⚠️ 缺失
- [ ] 用户注册页面（邮箱注册、邀请码注册）
- [ ] 用户登录页面
- [ ] 忘记密码/重置密码
- [ ] 邮箱验证
- [ ] 第三方登录（可选：Google、GitHub）
- [ ] 图形验证码/人机验证

#### 2. **用户仪表板** ⚠️ 缺失
- [ ] 个人信息展示（用户名、邮箱、套餐、到期时间）
- [ ] 流量使用情况（已用/总量、使用率、重置时间）
- [ ] 账户状态（正常/过期/禁用）
- [ ] 快速连接指南
- [ ] 公告通知展示

#### 3. **节点/订阅管理** ⚠️ 缺失
- [ ] 可用节点列表（名称、地区、延迟、负载）
- [ ] 节点测速功能
- [ ] 订阅链接生成和复制
- [ ] 订阅二维码展示
- [ ] 一键导入到客户端
- [ ] 订阅链接重置

#### 4. **客户端下载页面** ⚠️ 缺失
- [ ] 全平台客户端下载链接（Windows、Mac、Linux、Android、iOS）
- [ ] 客户端使用教程（图文/视频）
- [ ] 配置教程（订阅导入、手动配置）
- [ ] 常见问题解答
- [ ] 客户端版本更新提醒

#### 5. **套餐/订单管理** ⚠️ 缺失（如需商业化）
- [ ] 套餐列表展示（流量、价格、时长）
- [ ] 购买套餐
- [ ] 订单历史
- [ ] 支付集成（支付宝、微信、PayPal、加密货币）
- [ ] 发票管理

#### 6. **充值/续费系统** ⚠️ 缺失（如需商业化）
- [ ] 账户余额显示
- [ ] 充值页面
- [ ] 套餐续费
- [ ] 流量包购买
- [ ] 充值记录

#### 7. **邀请/推广系统** ⚠️ 缺失（可选）
- [ ] 邀请码生成
- [ ] 邀请链接分享
- [ ] 邀请记录查看
- [ ] 邀请奖励（返利、流量奖励）
- [ ] 推广统计

#### 8. **工单/客服系统** ⚠️ 缺失
- [ ] 提交工单
- [ ] 工单列表
- [ ] 工单详情和回复
- [ ] 在线客服（可选）
- [ ] 常见问题库

#### 9. **使用统计** ⚠️ 缺失
- [ ] 流量使用历史图表
- [ ] 每日/每周/每月统计
- [ ] 节点使用记录
- [ ] 在线设备数
- [ ] 连接日志

#### 10. **个人设置** ⚠️ 缺失
- [ ] 修改个人信息
- [ ] 修改密码
- [ ] 修改邮箱
- [ ] 通知设置（邮件、Telegram）
- [ ] 安全设置（2FA）
- [ ] 主题切换

#### 11. **公告/通知中心** ⚠️ 缺失
- [ ] 系统公告列表
- [ ] 公告详情
- [ ] 站内消息
- [ ] 消息已读/未读状态
- [ ] 流量到期提醒

#### 12. **知识库/帮助中心** ⚠️ 缺失
- [ ] 使用教程分类
- [ ] 教程详情页
- [ ] 视频教程
- [ ] 常见问题
- [ ] 搜索功能

---

## 📊 用户前台页面架构建议

### 页面结构
```
用户前台 (User Portal)
├── 首页/登录页
├── 注册页
├── 用户仪表板
│   ├── 概览
│   ├── 流量统计
│   └── 快速操作
├── 节点管理
│   ├── 节点列表
│   ├── 订阅管理
│   └── 测速工具
├── 客户端下载
│   ├── 下载链接
│   └── 使用教程
├── 套餐中心（可选）
│   ├── 套餐列表
│   ├── 购买页面
│   └── 订单管理
├── 财务中心（可选）
│   ├── 充值
│   ├── 账单
│   └── 发票
├── 邀请推广（可选）
│   ├── 邀请码
│   ├── 邀请记录
│   └── 奖励统计
├── 工单系统
│   ├── 提交工单
│   └── 工单列表
├── 个人中心
│   ├── 个人信息
│   ├── 安全设置
│   └── 通知设置
├── 公告中心
│   ├── 系统公告
│   └── 站内消息
└── 帮助中心
    ├── 使用教程
    ├── 常见问题
    └── 视频教程
```

### 技术实现建议
- **前端框架**: Vue 3 + Element Plus（与管理后台保持一致）
- **路由**: Vue Router（独立路由，与管理后台分离）
- **状态管理**: Pinia
- **API**: RESTful API（复用后端 API，增加用户端接口）
- **响应式**: 支持移动端访问
- **主题**: 支持深色/浅色模式

---

## 🎯 优先级建议

### 高优先级（必备功能）
1. **用户注册/登录系统** - 基础功能
2. **用户仪表板** - 核心展示页面
3. **节点/订阅管理** - 核心功能
4. **客户端下载页面** - 用户必需
5. **个人设置** - 基础功能

### 中优先级（提升体验）
6. **使用统计** - 数据可视化
7. **公告/通知中心** - 信息传达
8. **工单/客服系统** - 用户支持
9. **知识库/帮助中心** - 降低支持成本

### 低优先级（商业化/可选）
10. **套餐/订单管理** - 商业化需求
11. **充值/续费系统** - 商业化需求
12. **邀请/推广系统** - 增长功能

---

## 📱 用户前台与管理后台的区别

| 功能 | 管理后台 | 用户前台 |
|------|---------|---------|
| 用户对象 | 管理员 | 普通用户 |
| 权限级别 | 高权限 | 低权限 |
| 功能范围 | 全局管理 | 个人管理 |
| 数据范围 | 所有数据 | 个人数据 |
| 操作权限 | 增删改查 | 查看+有限修改 |
| 界面风格 | 专业管理 | 简洁友好 |

---

## 💡 参考案例

类似的代理面板用户前台功能可参考：
- V2board 用户端
- SSPanel 用户端
- XBoard 用户端

---

# 客户端推荐

## 📱 全平台客户端列表

### Windows 客户端

#### 1. **v2rayN** (推荐)
- **下载地址**: https://github.com/2dust/v2rayN/releases
- **支持协议**: VMess, VLESS, Shadowsocks, Trojan, Socks, HTTP
- **特点**: 界面简洁、支持订阅、路由规则、自动更新核心

#### 2. **Clash for Windows**
- **下载地址**: https://github.com/Fndroid/clash_for_windows_pkg/releases
- **支持协议**: VMess, VLESS, Shadowsocks, Trojan, Socks, HTTP
- **特点**: 图形化界面、规则分流、订阅转换

### macOS 客户端

#### 1. **V2rayU** (推荐)
- **下载地址**: https://github.com/yanue/V2rayU/releases
- **支持协议**: VMess, VLESS, Shadowsocks, Trojan, Socks, HTTP
- **特点**: 原生应用、菜单栏快速切换、支持订阅

#### 2. **ClashX**
- **下载地址**: https://github.com/yichengchen/clashX/releases
- **支持协议**: VMess, VLESS, Shadowsocks, Trojan, Socks, HTTP
- **特点**: 原生应用、规则分流、简洁易用

### Linux 客户端

#### 1. **v2rayA** (推荐)
- **下载地址**: https://github.com/v2rayA/v2rayA/releases
- **支持协议**: VMess, VLESS, Shadowsocks, Trojan, Socks, HTTP
- **特点**: Web 界面、支持订阅、透明代理

#### 2. **Qv2ray**
- **下载地址**: https://github.com/Qv2ray/Qv2ray/releases
- **支持协议**: VMess, VLESS, Shadowsocks, Trojan, Socks, HTTP
- **特点**: 图形化界面、跨平台、插件支持

### Android 客户端

#### 1. **v2rayNG** (推荐)
- **下载地址**: https://github.com/2dust/v2rayNG/releases
- **支持协议**: VMess, VLESS, Shadowsocks, Trojan, Socks, HTTP
- **特点**: 开源免费、支持订阅、分应用代理

#### 2. **Clash for Android**
- **下载地址**: https://github.com/Kr328/ClashForAndroid/releases
- **支持协议**: VMess, VLESS, Shadowsocks, Trojan, Socks, HTTP
- **特点**: 规则分流、图形化界面

### iOS 客户端

#### 1. **Shadowrocket** (推荐)
- **下载地址**: App Store (付费 $2.99)
- **支持协议**: VMess, VLESS, Shadowsocks, Trojan, Socks, HTTP
- **特点**: 稳定可靠、支持订阅、规则分流

#### 2. **Quantumult X**
- **下载地址**: App Store (付费 $7.99)
- **支持协议**: VMess, VLESS, Shadowsocks, Trojan, Socks, HTTP
- **特点**: 功能强大、脚本支持、高级规则

#### 3. **Surge**
- **下载地址**: App Store (付费 $49.99)
- **支持协议**: VMess, VLESS, Shadowsocks, Trojan, Socks, HTTP
- **特点**: 专业级工具、强大规则引擎、网络调试


---

## 📊 功能实现状态汇总

### 后端管理功能状态

| 功能模块 | 状态 | 说明 |
|---------|------|------|
| 用户认证 (JWT) | ✅ 已完成 | 登录、登出、令牌刷新 |
| 用户管理 | ✅ 已完成 | CRUD、启用/禁用、密码重置 |
| 角色权限 | ✅ 已完成 | 角色管理、权限分配 |
| 代理管理 | ✅ 已完成 | 多协议、启停控制、批量操作 |
| 流量统计 | ✅ 已完成 | Dashboard、协议统计、用户统计 |
| 证书管理 | ✅ 已完成 | SSL 申请、续期、验证 |
| Xray 管理 | ✅ 已完成 | 启停、配置、版本管理 |
| 日志系统 | ✅ 已完成 | 查询、导出、清理 |
| 系统设置 | ✅ 已完成 | 配置管理、备份恢复 |
| 订阅链接 | 📝 Spec 已创建 | 待实现 |
| Telegram Bot | 🔜 待规划 | - |
| IP 限制 | 🔜 待规划 | - |
| 数据库备份 | 🔜 待规划 | - |
| 多服务器管理 | 🔜 待规划 | - |

### 用户前台功能状态

| 功能模块 | 状态 | 优先级 |
|---------|------|--------|
| 用户注册/登录 | 📝 Spec 已创建 | 高 |
| 用户仪表板 | 📝 Spec 已创建 | 高 |
| 节点/订阅管理 | 📝 Spec 已创建 | 高 |
| 客户端下载页 | 📝 Spec 已创建 | 高 |
| 个人设置 | 📝 Spec 已创建 | 高 |
| 使用统计 | 📝 Spec 已创建 | 中 |
| 公告/通知中心 | 📝 Spec 已创建 | 中 |
| 工单/客服系统 | 📝 Spec 已创建 | 中 |
| 知识库/帮助中心 | 📝 Spec 已创建 | 中 |
| 套餐/订单管理 | ⚠️ 缺失 | 低（商业化） |
| 充值/续费系统 | ⚠️ 缺失 | 低（商业化） |
| 邀请/推广系统 | ⚠️ 缺失 | 低（可选） |

---

## 🎯 建议的实现顺序

### 第一阶段：核心功能完善
1. ✅ 订阅链接功能 (Spec 已创建) - `.kiro/specs/subscription-system/`
2. ✅ 用户前台门户 (Spec 已创建) - `.kiro/specs/user-portal/`
3. 🔜 IP 限制功能
4. 🔜 Telegram Bot 集成

### 第二阶段：运维功能
5. 🔜 数据库备份/恢复
6. 🔜 多服务器管理
7. 🔜 高级流量功能

### 第三阶段：商业化（可选）
8. 套餐/订单管理
9. 充值/续费系统
10. 邀请/推广系统
