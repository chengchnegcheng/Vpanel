# 用户门户与管理后台集成测试

## 测试目标

验证用户门户和管理后台的访问控制和跳转逻辑是否正确实现。

## 测试环境

- 前端服务：http://localhost:8080
- 测试账号：
  - 管理员账号：admin / admin123
  - 普通用户账号：user / user123

## 测试用例

### 1. 根路径访问测试

#### 1.1 未登录访问根路径
- **操作**：清除所有 localStorage，访问 `http://localhost:8080/`
- **预期结果**：自动跳转到 `/user/login`（用户门户登录页）
- **验证点**：
  - URL 变为 `/user/login`
  - 显示用户登录页面
  - 页面标题为"用户登录"

#### 1.2 普通用户登录后访问根路径
- **操作**：
  1. 使用普通用户账号登录
  2. 访问 `http://localhost:8080/`
- **预期结果**：自动跳转到 `/user/dashboard`
- **验证点**：
  - URL 变为 `/user/dashboard`
  - 显示用户仪表板
  - localStorage 中有 `userToken` 和 `userRole=user`

#### 1.3 管理员登录后访问根路径
- **操作**：
  1. 使用管理员账号登录
  2. 访问 `http://localhost:8080/`
- **预期结果**：自动跳转到 `/admin/dashboard`
- **验证点**：
  - URL 变为 `/admin/dashboard`
  - 显示管理后台仪表板
  - localStorage 中有 `token`、`userToken` 和 `userRole=admin`

### 2. 旧管理员登录页面访问测试

#### 2.1 访问 /login
- **操作**：访问 `http://localhost:8080/login`
- **预期结果**：自动重定向到 `/user/login`
- **验证点**：
  - URL 变为 `/user/login`
  - 显示用户登录页面
  - 不显示旧的管理员登录页面

#### 2.2 访问 /register
- **操作**：访问 `http://localhost:8080/register`
- **预期结果**：自动重定向到 `/user/login`
- **验证点**：
  - URL 变为 `/user/login`
  - 显示用户登录页面

### 3. 用户门户登录测试

#### 3.1 普通用户登录
- **操作**：
  1. 访问 `/user/login`
  2. 输入普通用户账号密码
  3. 点击登录
- **预期结果**：
  - 登录成功提示
  - 自动跳转到 `/user/dashboard`
  - localStorage 中保存 `userToken` 和 `userRole=user`
- **验证点**：
  - 可以访问用户门户的所有页面
  - 无法访问 `/admin/*` 路径（会被重定向）

#### 3.2 管理员用户登录
- **操作**：
  1. 访问 `/user/login`
  2. 输入管理员账号密码
  3. 点击登录
- **预期结果**：
  - 登录成功提示
  - 自动跳转到 `/admin/dashboard`（管理后台）
  - localStorage 中保存 `token`、`userToken` 和 `userRole=admin`
- **验证点**：
  - 可以访问管理后台的所有页面
  - 可以访问用户门户的页面（管理员有全部权限）

### 4. 管理后台访问控制测试

#### 4.1 未登录访问管理后台
- **操作**：
  1. 清除所有 localStorage
  2. 访问 `http://localhost:8080/admin/dashboard`
- **预期结果**：
  - 自动跳转到 `/user/login?redirect=/admin/dashboard`
  - 登录成功后跳转回 `/admin/dashboard`
- **验证点**：
  - URL 包含 redirect 参数
  - 登录后正确跳转

#### 4.2 普通用户访问管理后台
- **操作**：
  1. 使用普通用户账号登录
  2. 尝试访问 `http://localhost:8080/admin/dashboard`
- **预期结果**：
  - 自动跳转到 `/user/dashboard`
  - 显示用户门户仪表板
- **验证点**：
  - 无法访问管理后台
  - 不显示错误提示（静默跳转）

#### 4.3 管理员访问管理后台
- **操作**：
  1. 使用管理员账号登录
  2. 访问 `http://localhost:8080/admin/dashboard`
- **预期结果**：
  - 正常显示管理后台仪表板
  - 可以访问所有管理功能
- **验证点**：
  - 所有管理后台页面可访问
  - 功能正常

### 5. 用户门户访问控制测试

#### 5.1 未登录访问用户门户
- **操作**：
  1. 清除所有 localStorage
  2. 访问 `http://localhost:8080/user/dashboard`
- **预期结果**：
  - 自动跳转到 `/user/login?redirect=/user/dashboard`
  - 登录成功后跳转回 `/user/dashboard`

#### 5.2 普通用户访问用户门户
- **操作**：
  1. 使用普通用户账号登录
  2. 访问用户门户各个页面
- **预期结果**：
  - 所有用户门户页面正常访问
  - 功能正常

#### 5.3 管理员访问用户门户
- **操作**：
  1. 使用管理员账号登录
  2. 访问用户门户各个页面
- **预期结果**：
  - 可以访问用户门户页面
  - 功能正常

### 6. 登出测试

#### 6.1 普通用户登出
- **操作**：
  1. 使用普通用户账号登录
  2. 点击登出按钮
- **预期结果**：
  - 清除 localStorage 中的 token
  - 跳转到 `/user/login`
- **验证点**：
  - `userToken` 被清除
  - `userInfo` 被清除
  - 无法访问需要认证的页面

#### 6.2 管理员登出
- **操作**：
  1. 使用管理员账号登录
  2. 点击登出按钮
- **预期结果**：
  - 清除 localStorage 中的所有 token
  - 跳转到 `/user/login`
- **验证点**：
  - `token` 被清除
  - `userToken` 被清除
  - `userRole` 被清除
  - 无法访问管理后台

### 7. 会话过期测试

#### 7.1 Token 过期后访问
- **操作**：
  1. 登录后手动删除 localStorage 中的 token
  2. 访问需要认证的页面
- **预期结果**：
  - API 返回 401 错误
  - 自动跳转到登录页
  - 显示"登录已过期"提示

### 8. 直接 URL 访问测试

#### 8.1 书签访问
- **操作**：
  1. 保存管理后台页面为书签
  2. 登出后通过书签访问
- **预期结果**：
  - 跳转到登录页
  - 登录后跳转回原页面

#### 8.2 浏览器前进后退
- **操作**：
  1. 登录后访问多个页面
  2. 使用浏览器前进后退按钮
- **预期结果**：
  - 路由正常切换
  - 页面正常显示
  - 不会触发重复的认证检查

## 测试结果记录

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 1.1 未登录访问根路径 | ⬜ 待测试 | |
| 1.2 普通用户登录后访问根路径 | ⬜ 待测试 | |
| 1.3 管理员登录后访问根路径 | ⬜ 待测试 | |
| 2.1 访问 /login | ⬜ 待测试 | |
| 2.2 访问 /register | ⬜ 待测试 | |
| 3.1 普通用户登录 | ⬜ 待测试 | |
| 3.2 管理员用户登录 | ⬜ 待测试 | |
| 4.1 未登录访问管理后台 | ⬜ 待测试 | |
| 4.2 普通用户访问管理后台 | ⬜ 待测试 | |
| 4.3 管理员访问管理后台 | ⬜ 待测试 | |
| 5.1 未登录访问用户门户 | ⬜ 待测试 | |
| 5.2 普通用户访问用户门户 | ⬜ 待测试 | |
| 5.3 管理员访问用户门户 | ⬜ 待测试 | |
| 6.1 普通用户登出 | ⬜ 待测试 | |
| 6.2 管理员登出 | ⬜ 待测试 | |
| 7.1 Token 过期后访问 | ⬜ 待测试 | |
| 8.1 书签访问 | ⬜ 待测试 | |
| 8.2 浏览器前进后退 | ⬜ 待测试 | |

## 已知问题

（测试过程中发现的问题记录在这里）

## 修复建议

（针对已知问题的修复建议）

## 测试总结

（测试完成后填写）

- 测试日期：
- 测试人员：
- 通过率：
- 主要问题：
- 建议：
