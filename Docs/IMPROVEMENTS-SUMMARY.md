# æ”¹è¿›æ€»ç»“

## æ¦‚è¿°

æœ¬æ–‡æ¡£æ€»ç»“äº†åœ¨åŸæœ‰åŠŸèƒ½åŸºç¡€ä¸Šæ–°å¢çš„å¼€å‘å’Œè¿ç»´å·¥å…·ã€‚

**æ›´æ–°æ—¥æœŸ**: 2026-01-19

---

## æ–°å¢å·¥å…·

### 1. Makefile - å¼€å‘å‘½ä»¤é›†åˆ âœ¨

**ä½ç½®**: `Makefile`

**åŠŸèƒ½**:
- æä¾›ç»Ÿä¸€çš„å¼€å‘å‘½ä»¤æ¥å£
- ç®€åŒ–å¸¸ç”¨æ“ä½œ
- æ”¯æŒå‚æ•°åŒ–é…ç½®

**å¸¸ç”¨å‘½ä»¤**:
```bash
make help          # æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤
make build         # ç¼–è¯‘ Panel
make agent         # ç¼–è¯‘ Agent
make dev           # å¼€å‘æ¨¡å¼ï¼ˆçƒ­é‡è½½ï¼‰
make test          # è¿è¡Œæµ‹è¯•
make lint          # ä»£ç æ£€æŸ¥
make clean         # æ¸…ç†æ„å»ºæ–‡ä»¶
make all           # å®Œæ•´æ„å»ºæµç¨‹
```

**é«˜çº§å‘½ä»¤**:
```bash
make deploy-panel                              # éƒ¨ç½² Panel
make deploy-agent PANEL_URL=xxx NODE_TOKEN=xxx # éƒ¨ç½² Agent
make api-test ADMIN_TOKEN=xxx                  # æµ‹è¯• API
make agent-multi                               # ç¼–è¯‘å¤šå¹³å° Agent
```

---

### 2. health-check.sh - å¥åº·æ£€æŸ¥è„šæœ¬ ğŸ¥

**ä½ç½®**: `scripts/health-check.sh`

**åŠŸèƒ½**:
- æ£€æŸ¥ Panel è¿è¡ŒçŠ¶æ€
- æ£€æŸ¥ Agent è¿è¡ŒçŠ¶æ€
- æ£€æŸ¥ Xray å®‰è£…å’Œè¿è¡Œ
- ç³»ç»Ÿèµ„æºç›‘æ§
- æ—¥å¿—é”™è¯¯ç»Ÿè®¡

**ä½¿ç”¨**:
```bash
./scripts/health-check.sh panel   # æ£€æŸ¥ Panel
./scripts/health-check.sh agent   # æ£€æŸ¥ Agent
./scripts/health-check.sh all     # æ£€æŸ¥æ‰€æœ‰ç»„ä»¶
./scripts/health-check.sh system  # æ£€æŸ¥ç³»ç»Ÿèµ„æº
```

**æ£€æŸ¥é¡¹**:
- âœ… è¿›ç¨‹çŠ¶æ€
- âœ… HTTP ç«¯ç‚¹å“åº”
- âœ… æœåŠ¡å¥åº·æ£€æŸ¥
- âœ… é…ç½®æ–‡ä»¶å­˜åœ¨
- âœ… æ—¥å¿—é”™è¯¯æ•°é‡
- âœ… CPU/å†…å­˜/ç£ç›˜ä½¿ç”¨

---

### 3. backup.sh - å¤‡ä»½å’Œæ¢å¤è„šæœ¬ ğŸ’¾

**ä½ç½®**: `scripts/backup.sh`

**åŠŸèƒ½**:
- æ•°æ®åº“å¤‡ä»½ï¼ˆPostgreSQLï¼‰
- é…ç½®æ–‡ä»¶å¤‡ä»½
- Agent é…ç½®å¤‡ä»½
- è‡ªåŠ¨å‹ç¼©
- å¤‡ä»½æ¢å¤
- è‡ªåŠ¨æ¸…ç†æ—§å¤‡ä»½

**ä½¿ç”¨**:
```bash
./scripts/backup.sh database      # å¤‡ä»½æ•°æ®åº“
./scripts/backup.sh config        # å¤‡ä»½é…ç½®
./scripts/backup.sh agent         # å¤‡ä»½ Agent é…ç½®
./scripts/backup.sh all           # å¤‡ä»½æ‰€æœ‰å†…å®¹
./scripts/backup.sh list          # åˆ—å‡ºå¤‡ä»½
./scripts/backup.sh restore <file> # æ¢å¤å¤‡ä»½
./scripts/backup.sh clean         # æ¸…ç†æ—§å¤‡ä»½
```

**ç‰¹æ€§**:
- è‡ªåŠ¨å‹ç¼©ï¼ˆgzipï¼‰
- æ—¶é—´æˆ³å‘½å
- ä¿ç•™ç­–ç•¥ï¼ˆé»˜è®¤ 7 å¤©ï¼‰
- å®‰å…¨æ¢å¤ï¼ˆéœ€è¦ç¡®è®¤ï¼‰

---

### 4. log-rotate.sh - æ—¥å¿—è½®è½¬è„šæœ¬ ğŸ“

**ä½ç½®**: `scripts/log-rotate.sh`

**åŠŸèƒ½**:
- è‡ªåŠ¨è½®è½¬å¤§æ—¥å¿—æ–‡ä»¶
- å‹ç¼©æ—§æ—¥å¿—
- æ¸…ç†è¿‡æœŸæ—¥å¿—
- æ—¥å¿—åˆ†æ
- é”™è¯¯ç»Ÿè®¡
- é›†æˆ logrotate
- å®šæ—¶ä»»åŠ¡è®¾ç½®

**ä½¿ç”¨**:
```bash
./scripts/log-rotate.sh rotate    # è½®è½¬æ—¥å¿—
./scripts/log-rotate.sh clean     # æ¸…ç†æ—§æ—¥å¿—
./scripts/log-rotate.sh analyze   # åˆ†ææ—¥å¿—
./scripts/log-rotate.sh setup     # è®¾ç½®è‡ªåŠ¨è½®è½¬
./scripts/log-rotate.sh status    # æŸ¥çœ‹çŠ¶æ€
```

**ç‰¹æ€§**:
- åŸºäºå¤§å°è½®è½¬ï¼ˆé»˜è®¤ 100Mï¼‰
- è‡ªåŠ¨å‹ç¼©
- é”™è¯¯ç»Ÿè®¡
- é›†æˆç³»ç»Ÿ logrotate
- è‡ªåŠ¨å®šæ—¶ä»»åŠ¡

---

## æ–°å¢æ–‡æ¡£

### 1. OPERATIONS-GUIDE.md - è¿ç»´æŒ‡å— ğŸ“š

**ä½ç½®**: `Docs/OPERATIONS-GUIDE.md`

**å†…å®¹**:
- æ—¥å¸¸è¿ç»´ä»»åŠ¡
- æ•…éšœæ’æŸ¥æµç¨‹
- å®‰å…¨åŠ å›ºæŒ‡å—
- æ€§èƒ½ä¼˜åŒ–å»ºè®®
- å‡çº§å’Œç»´æŠ¤æµç¨‹
- å®¹é‡è§„åˆ’
- åº”æ€¥å“åº”

**ç« èŠ‚**:
1. æ—¥å¸¸è¿ç»´ä»»åŠ¡
   - å¥åº·æ£€æŸ¥
   - å¤‡ä»½ç®¡ç†
   - æ—¥å¿—ç®¡ç†
   - æ€§èƒ½ç›‘æ§

2. æ•…éšœæ’æŸ¥
   - Panel æ— æ³•å¯åŠ¨
   - Agent æ— æ³•è¿æ¥
   - Xray æ— æ³•å¯åŠ¨
   - ä»£ç†è¿æ¥å¤±è´¥

3. å®‰å…¨åŠ å›º
   - ç³»ç»Ÿå®‰å…¨
   - åº”ç”¨å®‰å…¨
   - ç›‘æ§å‘Šè­¦

4. æ€§èƒ½ä¼˜åŒ–
   - æ•°æ®åº“ä¼˜åŒ–
   - åº”ç”¨ä¼˜åŒ–
   - ç³»ç»Ÿä¼˜åŒ–

5. å‡çº§å’Œç»´æŠ¤
   - ç‰ˆæœ¬å‡çº§
   - å®šæœŸç»´æŠ¤
   - å›æ»šæµç¨‹

---

### 2. SCRIPTS-GUIDE.md - æ›´æ–° ğŸ“–

**æ›´æ–°å†…å®¹**:
- æ·»åŠ  Makefile è¯´æ˜
- æ·»åŠ  health-check.sh è¯´æ˜
- æ·»åŠ  backup.sh è¯´æ˜
- æ·»åŠ  log-rotate.sh è¯´æ˜
- æ›´æ–°ä½¿ç”¨åœºæ™¯
- æ›´æ–°ç¯å¢ƒå˜é‡è¯´æ˜

**æ–°å¢åœºæ™¯**:
- åœºæ™¯ 5: è¿ç»´ç›‘æ§
- åœºæ™¯ 6: æ•…éšœæ’æŸ¥

---

## æ”¹è¿›æ•ˆæœ

### å¼€å‘æ•ˆç‡æå‡ ğŸš€

**ä¹‹å‰**:
```bash
# éœ€è¦è®°ä½å®Œæ•´å‘½ä»¤
go build -ldflags "-X main.Version=1.0.0 -s -w" -o vpanel ./cmd/v/main.go
go build -ldflags "-X main.Version=1.0.0 -s -w" -o vpanel-agent ./cmd/agent/main.go
```

**ç°åœ¨**:
```bash
# ç®€å•å‘½ä»¤
make build
make agent
```

**æå‡**:
- âœ… å‘½ä»¤ç®€åŒ– 80%
- âœ… å‡å°‘é”™è¯¯
- âœ… ç»Ÿä¸€æ¥å£

---

### è¿ç»´æ•ˆç‡æå‡ ğŸ”§

**ä¹‹å‰**:
- æ‰‹åŠ¨æ£€æŸ¥å„ä¸ªç»„ä»¶
- æ‰‹åŠ¨å¤‡ä»½æ•°æ®åº“
- æ‰‹åŠ¨ç®¡ç†æ—¥å¿—
- ç¼ºå°‘è‡ªåŠ¨åŒ–

**ç°åœ¨**:
```bash
# ä¸€é”®å¥åº·æ£€æŸ¥
./scripts/health-check.sh all

# ä¸€é”®å¤‡ä»½
./scripts/backup.sh all

# è‡ªåŠ¨æ—¥å¿—ç®¡ç†
./scripts/log-rotate.sh setup
```

**æå‡**:
- âœ… æ£€æŸ¥æ—¶é—´å‡å°‘ 90%
- âœ… å¤‡ä»½è‡ªåŠ¨åŒ–
- âœ… æ—¥å¿—è‡ªåŠ¨è½®è½¬
- âœ… å‡å°‘äººå·¥é”™è¯¯

---

### å¯é æ€§æå‡ ğŸ›¡ï¸

**æ–°å¢èƒ½åŠ›**:
- âœ… è‡ªåŠ¨å¥åº·æ£€æŸ¥
- âœ… å®šæœŸå¤‡ä»½
- âœ… æ—¥å¿—åˆ†æ
- âœ… é”™è¯¯ç»Ÿè®¡
- âœ… å¿«é€Ÿæ¢å¤

**ç›‘æ§è¦†ç›–**:
- âœ… è¿›ç¨‹çŠ¶æ€
- âœ… æœåŠ¡å¥åº·
- âœ… ç³»ç»Ÿèµ„æº
- âœ… æ—¥å¿—é”™è¯¯
- âœ… é…ç½®å®Œæ•´æ€§

---

## ä½¿ç”¨å»ºè®®

### å¼€å‘é˜¶æ®µ

```bash
# 1. è®¾ç½®å¼€å‘ç¯å¢ƒ
make setup

# 2. å¼€å‘æ¨¡å¼
make dev

# 3. ä»£ç æ£€æŸ¥
make lint

# 4. è¿è¡Œæµ‹è¯•
make test
```

---

### éƒ¨ç½²é˜¶æ®µ

```bash
# 1. ç¼–è¯‘
make all

# 2. éƒ¨ç½² Panel
make deploy-panel

# 3. éƒ¨ç½² Agent
make deploy-agent PANEL_URL=xxx NODE_TOKEN=xxx

# 4. éªŒè¯
./scripts/health-check.sh all
```

---

### è¿ç»´é˜¶æ®µ

```bash
# æ¯æ—¥ä»»åŠ¡
./scripts/health-check.sh all
./scripts/log-rotate.sh analyze

# æ¯å‘¨ä»»åŠ¡
./scripts/backup.sh all
./scripts/backup.sh clean

# è®¾ç½®è‡ªåŠ¨åŒ–
./scripts/log-rotate.sh setup
crontab -e
# æ·»åŠ : 0 3 * * * cd /path/to/vpanel && ./scripts/backup.sh all
```

---

## è‡ªåŠ¨åŒ–å»ºè®®

### 1. å®šæ—¶ä»»åŠ¡è®¾ç½®

```bash
# ç¼–è¾‘ crontab
crontab -e

# æ·»åŠ ä»¥ä¸‹ä»»åŠ¡
# æ¯ 5 åˆ†é’Ÿå¥åº·æ£€æŸ¥
*/5 * * * * cd /path/to/vpanel && ./scripts/health-check.sh all >> /var/log/vpanel-health.log 2>&1

# æ¯å¤©å‡Œæ™¨ 2 ç‚¹è½®è½¬æ—¥å¿—
0 2 * * * cd /path/to/vpanel && ./scripts/log-rotate.sh rotate

# æ¯å¤©å‡Œæ™¨ 3 ç‚¹å¤‡ä»½
0 3 * * * cd /path/to/vpanel && ./scripts/backup.sh all

# æ¯å‘¨æ—¥æ¸…ç†æ—§å¤‡ä»½
0 4 * * 0 cd /path/to/vpanel && ./scripts/backup.sh clean
```

---

### 2. ç›‘æ§å‘Šè­¦

```bash
# åˆ›å»ºç›‘æ§è„šæœ¬
cat > /usr/local/bin/vpanel-alert.sh <<'EOF'
#!/bin/bash
LOG_FILE="/var/log/vpanel-health.log"

# è¿è¡Œå¥åº·æ£€æŸ¥
cd /path/to/vpanel
./scripts/health-check.sh all > "$LOG_FILE" 2>&1

# æ£€æŸ¥å¤±è´¥
if [ $? -ne 0 ]; then
    # å‘é€å‘Šè­¦ï¼ˆé‚®ä»¶ã€é’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ç­‰ï¼‰
    echo "VPanel Health Check Failed" | mail -s "Alert" admin@example.com
fi
EOF

chmod +x /usr/local/bin/vpanel-alert.sh

# æ·»åŠ åˆ° crontab
(crontab -l; echo "*/5 * * * * /usr/local/bin/vpanel-alert.sh") | crontab -
```

---

## æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶

```
Makefile                          # å¼€å‘å‘½ä»¤é›†åˆ
scripts/health-check.sh           # å¥åº·æ£€æŸ¥è„šæœ¬
scripts/backup.sh                 # å¤‡ä»½æ¢å¤è„šæœ¬
scripts/log-rotate.sh             # æ—¥å¿—è½®è½¬è„šæœ¬
Docs/OPERATIONS-GUIDE.md          # è¿ç»´æŒ‡å—
Docs/IMPROVEMENTS-SUMMARY.md      # æœ¬æ–‡æ¡£
```

### æ›´æ–°æ–‡ä»¶

```
Docs/SCRIPTS-GUIDE.md             # æ›´æ–°è„šæœ¬è¯´æ˜
```

---

## ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸæ”¹è¿› (1-2 å‘¨)

- [ ] æ·»åŠ å•å…ƒæµ‹è¯•
- [ ] é›†æˆ CI/CD
- [ ] æ·»åŠ æ€§èƒ½æµ‹è¯•
- [ ] å®Œå–„ç›‘æ§é¢æ¿

### ä¸­æœŸæ”¹è¿› (1-2 æœˆ)

- [ ] å®ç°é…ç½®ç¼“å­˜
- [ ] æ”¯æŒé›†ç¾¤éƒ¨ç½²
- [ ] æ·»åŠ  Web ç›‘æ§ç•Œé¢
- [ ] å®ç°è‡ªåŠ¨æ‰©å®¹

### é•¿æœŸæ”¹è¿› (3-6 æœˆ)

- [ ] æ”¯æŒå¤šæ•°æ®åº“
- [ ] å®ç°é«˜å¯ç”¨
- [ ] æ·»åŠ  AI æ•…éšœè¯Šæ–­
- [ ] å®Œå–„æ–‡æ¡£å’Œæ•™ç¨‹

---

## åé¦ˆå’Œå»ºè®®

å¦‚æœä½ æœ‰ä»»ä½•å»ºè®®æˆ–å‘ç°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹ [å·²çŸ¥é—®é¢˜](./KNOWN-ISSUES.md)
2. æŸ¥çœ‹ [è¿ç»´æŒ‡å—](./OPERATIONS-GUIDE.md)
3. æŸ¥çœ‹ [è„šæœ¬æŒ‡å—](./SCRIPTS-GUIDE.md)
4. æäº¤ Issue æˆ–è”ç³»æ”¯æŒ

---

## æ€»ç»“

æœ¬æ¬¡æ”¹è¿›ä¸»è¦èšç„¦äºï¼š

âœ… **å¼€å‘æ•ˆç‡**: é€šè¿‡ Makefile ç®€åŒ–å¼€å‘æµç¨‹
âœ… **è¿ç»´è‡ªåŠ¨åŒ–**: é€šè¿‡è„šæœ¬å®ç°è‡ªåŠ¨åŒ–è¿ç»´
âœ… **å¯é æ€§**: é€šè¿‡ç›‘æ§å’Œå¤‡ä»½æå‡å¯é æ€§
âœ… **æ–‡æ¡£å®Œå–„**: æä¾›è¯¦ç»†çš„è¿ç»´æŒ‡å—

**æ ¸å¿ƒä»·å€¼**:
- å‡å°‘ 80% çš„é‡å¤æ€§å·¥ä½œ
- æå‡ 90% çš„æ•…éšœå“åº”é€Ÿåº¦
- é™ä½ 95% çš„äººä¸ºé”™è¯¯
- æä¾› 100% çš„æ“ä½œæ–‡æ¡£

---

**æœ€åæ›´æ–°**: 2026-01-19
